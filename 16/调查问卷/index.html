<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>调查问卷主页</title>
    <script src="../../jquery-3.2.1.js" type="text/javascript"></script>
    <script src="../../vue.js" type="text/javascript"></script>
    <script src="../../echarts.js" type="text/javascript"></script>
    <!--头部内容-->
    <style>
        #header{
            background-color: #ee7419;
            height: 50px;width: 100%;
            position: fixed;
            padding-left: 100px;
            z-index: 100;
        }
        #header span{
            display: inline-block;
            font: bold 22px/26px '微软雅黑';
            color: #fff;
        }
        #header>span{
            float: left;
            margin-top: 10px;
        }
        #header #title{
            margin-right: 70px;
            margin-top: 13px;
        }
        #header #circle{
            margin-top: 13px;
            margin-right: 8px;
            width: 26px;
            border-radius: 50%;
            background-color: #fff;
            color: #ee7419;
            text-align: center;
        }
        #header .tag{
            font-weight: normal;
            font-size: 17px;
            margin-left: 10px;
            border-radius: 10px 10px 0 0 ;
            height: 35px;width: 100px;
            text-align: center;
            padding-top: 5px;
        }
        #header .tag:hover{
            background-color: white;
            color: #ee7419;
            cursor: pointer;
        }
        #header .checked{
            display: block!important;
            color: #ee7419;
            background-color: #fcf0e5;
        }
        #header #newWenTag,#header #editWenTag,#header #showWenTag{display: none}
    </style>
    <!--主要内容-->
    <style>
        html,body,#container{height: 100%}
        body{margin: 0;padding: 0;}
        #content{
            min-height: 100%;width: 100%;
            text-align: center;
            background-color: #ddd;
            z-index: -1;
        }
        #blank{height: 100px}
        #content table{
            background-color: white;
            overflow: hidden;
            margin: 0 auto;
            text-align: left;
            width: 820px;
            border-collapse: collapse;
            /*这一句必须有，否则tr的边框显示无效*/
        }
        #content table tr{
            height: 40px;
        }
        #content tbody tr{
            border-bottom: 2px solid #ddd;
        }
        #content tbody tr:not(#last):hover{
            background-color: #fcf0e5;
        }
        #content table thead{
            background-color: #eee;
        }
        #content tbody{
            font-size: 15px;
            border-left: 40px solid #fff;
            border-right: 40px solid #fff;
        }
        #content .col1{width: 40px;text-align: center;}
        #content .col2{width: 400px;}
        #content .col3{width: 250px;}
        #content .col4{width: 80px;}
        #content .col5{width: 200px;}
        input[type='button']{
            background-color: #fff;
            outline: none;
            border-radius: 5px;
            cursor: pointer;
        }
        input[type='button']:hover{
            color: #fff;
            background-color: #ee7419;
        }
        #content .ing{
            color: #00e600;
        }
        #content #last{
            height: 50px;
            border: none;
        }
        #last td:first-child{
            position: relative;
        }
        #content #newWen{
            display: inline-block;
            position: absolute;
            left: 250px;top: 13px;
            color: #fff;
            width: 100px;height: 24px;
            background-color: #ee7419;
            line-height: 20px;
        }
        #content tbody .selected{
            background-color: #fcf0e5;
        }
        #content .big{
            display: none;
            background-color: white;
            /*overflow: hidden;*/
            margin: 0 auto;
            /*text-align: left;*/
            width: 820px;min-height: 400px;
            position: relative;
        }
    </style>
    <!--新建问卷-->
    <style>
        #content .main{
            padding: 10px;
        }
        #content .wenName{
            padding: 5px 40px 0 40px;
            margin-bottom: 10px;
            height: 55px;
            overflow: hidden;
        }
        #content .wenName>*{
            margin: 0 0 5px 0;
            height: 55px;
            font: bold 20px/50px '微软雅黑';
            text-align: center;
            border: 1px solid #fff;
        }
        #content .wenName p{
            cursor: pointer;
        }
        #content .wenName>*:hover{
            background-color: #fcf0e5;
        }
        #content .wenName input{
            display: none;
            outline: none;
            border-radius: 8px;
            border-color: #aaa;
            height: 48px;
            padding: 0;
            display: block;
            width: 100%;
        }
        #content .wenName input{
            box-shadow: 0 0 3px 1px rgba(48, 174, 255, 0.8);
        }
        #content .wenBody{
            padding: 15px 40px;
        }
        #content .wenBody ul{
            margin: 0;
            list-style: none;
            text-align: left;
        }
        .wenQs{
            padding-top: 10px;
        }
        .wenQs:hover{
            background-color: #fcf0e5;
        }
        #content .wenBody li>span{
            display: none;
            cursor: pointer;
            font-weight: bold;
            color: #aaa;
            margin-left: 20px;
        }
        #content .wenBody ul>textarea{
            margin-left: 35px;
            width: 600px;
        }
        #content .wenBody li:hover{
            background-color: #eee;
        }
        #content .wenBody li:hover>span{
            display: inline-block;
        }
        #content .wenBody li:hover>span:hover{
            color: #000;
        }
        #content .wenBody li{
            line-height: 25px;
            font-size: 16px;
            margin-left: 32px;
        }
        #content .wenBody li img{
            float: right;
            border-top: 2px solid transparent;
            margin-right:10px;
            opacity: 0.2;
            cursor: pointer;
        }
        #content .wenBody li img:hover{
            opacity: 1;
        }
        #content .wenBody li:first-child{
            font-size: 18px;
            margin: 0;
        }

        .wenQs:hover .qsFunc{
            display: block;
        }
        .wenQs .qsFunc{
            height: 35px;
            display: none;
        }
        #content .qsList .qsFunc span{
            display: inline-block;
            margin-right: 15px;
            float: right;
            cursor: pointer;
            color: #aaa;
        }
        #content .qsList .qsFunc span:hover{
            color: #000;
        }
        #content .qsList .qsFunc span:first-child{
            color: rgba(255,0,0,0.46)
        }
        #content .qsList .qsFunc span:first-child:hover{
            color: rgba(255,0,0,0.9)
        }
        #content .qsList .qsFunc .newOption{
            float: left;
            border: 2px dotted  transparent;
            text-align: center;
            width: 300px;
            margin-left: 78px;
        }
        #content .qsList .qsFunc .newOption:hover{
            border: 2px dotted  #aaa;
        }
        .newQs{
            height: 50px;
            margin-top: 40px;
            border: 1px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
            background-color: #eee;
            color: #ccc;
            overflow: hidden;
        }
        .newQs:hover{
            color: black;
        }
        .newQs>div{
            height: 50px;
            line-height: 50px;
        }
        .wenOut{
            margin: 30px 55px 0 55px;
            height: 50px;
        }
        .wenOut input[type='button']{
            font-size: 18px;
            margin-right: 20px;
            float: right;
        }
        .during{
            margin: 20px 50px;
            height: 20px;
        }
        .during .left{
            float: left;
            margin-left: 10px;
        }
        .during select{
            height: 22px;
            text-align: center;
        }
    </style>
    <!--显示问卷数据-->
    <style>
        #showWenBody .showQsText{
            text-align: left;
        }
        #showBig #showWenName p:hover{
            background-color: transparent;
        }
        #showBig #showWenName p{
            cursor: auto;
        }
    </style>
    <!--浮动框-->
    <style>
        #float{
            background-color: rgba(0,0,0,0.3);
            height: 100%;width: 100%;
            position: absolute;
            top: 0;
            display: none;
            position: fixed;
        }
        #float #floatWindow{
            position: absolute;
            top: 40%;left: 50%;
            transform: translate(-50%,-50%);
            width: 300px;height: 150px;
            background-color: #fff;
        }
        #float #floatWindow.bigger{
            height: 210px;
        }
        #float #floatWindow.bigger #alertContent{
            height: 90px;
        }
        #float #alertHead{
            font-weight: bold;
            height: 35px;
            line-height: 33px;
            background-color: #eaeaea;
            padding: 0 20px;
        }
        #float #alertHead span{
            float: right;
            font-size: 32px;
            cursor: pointer;
            color: #aaa;
        }
        #float #alertHead span:hover{
            color: #000;
        }
        #float #alertContent{
            height: 30px;
            padding: 20px;
        }
        #float #alertContent input{
            width: 250px;
        }
        #float .windowB{
            padding: 10px;
            text-align: center;
        }
        #float .windowB input{
            font-size: 16px;
        }
        #float .windowB input:first-child{
            background-color:#f07600;
            color: white
        }
    </style>
</head>
<body>
<div id="container">
    <header id="header">
        <span id="circle">？</span>
        <span id="title">问卷管理</span>
        <span id="myWen" class="tag checked" onclick="titleClick()">我的问卷</span>
        <span id="newWenTag" class="tag">新建问卷</span>
        <span id="editWenTag" class="tag">编辑问卷</span>
        <span id="showWenTag" class="tag">查看数据</span>
    </header>
    <div id="content">
        <div id="blank"></div>
        <table cellspacing="0" id="mainTable">
            <thead>
                <tr>
                    <th></th>
                    <th>标题</th>
                    <th>截止时间</th>
                    <th>状态</th>
                </tr>
            </thead>
            <tbody v-html="wenlist">
            </tbody>
        </table>
        <div id="newBig" class="big">
            <div id="newMain" class="main">
                <div id="newWenName" class="wenName">
                    <p>{{newwenjuan[0].name}}</p>
                    <input type="text" v-model="newwenjuan[0].name">
                </div>
                <hr height="3" color="#bbb">
                <div id="newWenBody" class="wenBody">
                    <div id="newWenQs" v-html="newWenQs" class="qsList"></div>
                    <div id="newWenNewQs" class="newQs">
                        <div id="new_newQsButton" class="qsButton">
                            ＋ 添加问题
                        </div>
                        <div>
                            <input type="button" value="+ 单选题" onclick="newQs('radio')">
                            <input type="button" value="+ 多选题" onclick="newQs('check')">
                            <input type="button" value="+ 简答题" onclick="newQs('text')">
                        </div>
                    </div>
                </div>
                <div class="during">
                    <span class="left">问卷的<b>发布</b>时间：</span>
                    <input class="left" type="datetime-local" v-model="newwenjuan[0].startTime" @change="checkDuring()">
                    <label for="new_startQuick">快捷设置：</label>
                    <select id="new_startQuick" onchange="newDuring(this.value,'startTime')"></select>
                </div>
                <div class="during">
                    <span class="left">问卷的<b>截止</b>时间：</span>
                    <input class="left" type="datetime-local" v-model="newwenjuan[0].deadline" @change="checkDuring()">
                    <label for="new_deadQuick">快捷设置：</label>
                    <select id="new_deadQuick" onchange="newDuring(this.value,'deadline')"></select>
                </div>
                <div id="newWenOut" class="wenOut">
                    <input type="button" value="保存" onclick="saveOut('stay','new')">
                    <input type="button" value="保存并退出" onclick="saveOut('','new')">
                    <input type="button" value="直接退出" onclick="noSaveOut()">
                </div>
            </div>
        </div>
        <div id="editBig" class="big">
            <div id="editMain" class="main">
                <div id="editWenName" class="wenName">
                    <p>{{editwenjuan[0].name}}</p>
                    <input type="text" v-model="editwenjuan[0].name">
                </div>
                <hr height="3" color="#bbb">
                <div id="editWenBody" class="wenBody">
                    <div id="editWenQs" v-html="newWenQs" class="qsList"></div>
                    <div id="editWenNewQs" class="newQs">
                        <div id="edit_newQsButton" class="qsButton">
                            ＋ 添加问题
                        </div>
                        <div>
                            <input type="button" value="+ 单选题" onclick="newQs('radio')">
                            <input type="button" value="+ 多选题" onclick="newQs('check')">
                            <input type="button" value="+ 简答题" onclick="newQs('text')">
                        </div>
                    </div>
                </div>
                <div class="during">
                    <span class="left">问卷的<b>发布</b>时间：</span>
                    <input class="left" type="datetime-local" v-model="editwenjuan[0].startTime" @change="checkDuring()">
                    <label for="edit_startQuick">快捷设置：</label>
                    <select id="edit_startQuick" onchange="newDuring(this.value,'startTime')"></select>
                </div>
                <div class="during">
                    <span class="left">问卷的<b>截止</b>时间：</span>
                    <input class="left" type="datetime-local" v-model="editwenjuan[0].deadline" @change="checkDuring()">
                    <label for="edit_deadQuick">快捷设置：</label>
                    <select id="edit_deadQuick" onchange="newDuring(this.value,'deadline')"></select>
                </div>
                <div id="editWenOut" class="wenOut">
                    <input type="button" value="保存" onclick="saveOut('stay','edit')">
                    <input type="button" value="保存并退出" onclick="saveOut('','edit')">
                    <input type="button" value="直接退出" onclick="noSaveOut()">
                </div>
            </div>
        </div>
        <div id="showBig" class="big">
            <div id="showMain" class="main">
                <div id="showWenName" class="wenName">
                    <p></p>
                </div>
                <hr height="3" color="#bbb">
                <div id="showWenBody" class="wenBody">

                </div>
                <div class="during" id="durStart">
                    <span>问卷的发布时间：</span>
                    <b></b>
                </div>
                <div class="during" id="durEnd">
                    <span>问卷的截止时间：</span>
                    <b></b>
                </div>
                <div id="showWenOut" class="wenOut">
                    <input type="button" value="回到主界面" onclick="returnMyWen()">
                </div>
            </div>
        </div>
    </div>
    <div id="float">
        <div id="floatWindow">
            <div id="alertHead">
                提示
                <span onclick="floatClose()">×</span>
            </div>
            <div id="alertContent" v-html="alertContent"></div>
            <div id="floatButton" v-html="floatButton"></div>
        </div>
    </div>
</div>
</body>
<!--初次绘制函数-->
<script>
    let quicksetOption =
        '                        <option value=""></option>\n' +
        '                        <option value="0"> 今天</option>\n' +
        '                        <option value="1">1 天后</option>\n' +
        '                        <option value="2">2 天后</option>\n' +
        '                        <option value="3">3 天后</option>\n' +
        '                        <option value="5">5 天后</option>\n' +
        '                        <option value="7">7 天后</option>\n' +
        '                        <option value="10">10天后</option>\n' +
        '                        <option value="30">30天后</option>\n' +
        '                        <option value="365">365天后</option>'
    $('#content .during select').append(quicksetOption);
</script>
<!--全局功能函数-->
<script>
    //检查问卷数量，如果为0则自动跳转新建页面
    function checkWen() {
        if (vm.wenjuan.length == 0){
            floatWindow('alert','noWen')
            newWen();
        }
    }

    //提示框-显示-被各种调用
    function floatWindow(button,content) {
        $('#alertContent input').val('');//否则浏览器会记录上次的内容
        vm.floatButton = vm.FBOption[button];
        vm.alertContent = vm.ACOption[content];
        $("#float").show();
        //这里vue处理需要时间，所以把focus放在timeout队列中
        setTimeout(function () {
            $('#alertContent input').eq(0).focus()
        },1)
    }
    //提示框-关闭
    function floatClose() {
        $("#float").hide().find("#floatWindow").removeClass('bigger');
    }

//新建问卷
    //新建问卷-启动函数
    function newWen() {
        $('#mainTable,#showBig,#editBig').hide();
        $('#newBig').show();
        $('#header .checked').removeClass('checked')
        $('#newWenTag').addClass('checked')
        $('#content #newMain select option:first-child').prop('selected','true')
        vm.editOrNew = 'new'
        newDuring();
    }
    //新建问卷-新建截止日期，默认设置为当前日期
    function newDuring(dayafter,type) {
        let date = new Date();
        let date1;
        if(dayafter!=undefined){
            dayafter = Number(dayafter);
            date1 = new Date(date.getFullYear(),date.getMonth(),(date.getDate()+dayafter));
        }else{date1 = date;}
        let day = ('0'+date1.getDate()).slice(-2);
        let month = ('0'+(date1.getMonth()+1)).slice(-2);
        let year = date1.getFullYear()
        let hour = ('0'+date.getHours()).slice(-2);
        let minute = ('0'+date.getMinutes()).slice(-2);
        let which = vm.editOrNew+'wenjuan';
        if(type == 'deadline'){
            vm[which][0].deadline = year+'-'+month+'-'+day+'T'+hour+':'+minute;
        }else if(type == 'startTime'){
            vm[which][0].startTime = year+'-'+month+'-'+day+'T'+hour+':'+minute;
        }else if(type == undefined){
            vm[which][0].deadline = vm[which][0].startTime = year+'-'+month+'-'+day+'T'+hour+':'+minute;
        }
        vm.checkDuring();
    }
    //日期-日期比较，输入1012-12-33 12:11这种数据，返回x是否比y大的Boolean
    function compareDate(x,y) {
        if(typeof x == "string"){
            x = new Date(x.replace(/-/g,"\/"));
        }
        if(typeof y == "string"){
            y = new Date(y.replace(/-/g,"\/"));
        }
        return x > y;
    }
    //新建问卷-退出-不保存就退出的提示
    function noSaveOut() {
        floatWindow('noSaveOut','noSaveOut');
    }
    //新建问卷-退出-删除
    function delNowWen() {
        vm[vm.editOrNew+'wenjuan'] = [{
            name: '请输入标题',
            startTime:'',
            deadline: '',
            state: '发布中',
            question:[]
        }];
    }
    //新建问卷-退出-保存并退出
    function saveOut(state,which) {
        if(vm.checkDuring() && vm.checkData()){
            let newWenData = JSON.parse(JSON.stringify(vm[vm.editOrNew+'wenjuan'][0]));
            if(which == 'new'){
                vm.wenjuan.push(newWenData);
                delNowWen();//必须放在前面，好坑，放在跳转之后的话vm.editOrNew会变成''，导致delNowWen()不能正确的指向数组，然后把vm.wenjuan全清了
                if(state == 'stay'){
                    setTimeout(function () {//还是数据同步时间问题，深度复制好像是另一个线程？
                        $('#mainTable tbody input[name="select"]:last').prop('checked',true)
                        editWen();
                    },1)
                }
            }else if(which == 'edit'){
                vm.wenjuan.splice(vm.selectWenIndex,1,newWenData);
                delNowWen();//必须放在前面，好坑，放在跳转之后的话vm.editOrNew会变成''，导致delNowWen()不能正确的指向数组，然后把vm.wenjuan全清了
                if(state == 'stay'){//这里就不需要settimeout，不懂为什么
                        $('#mainTable tbody input[name="select"]').eq(vm.selectWenIndex).prop('checked',true)
                        editWen();
                }
            }else if(which == 'relative'){//懒得把这条数据放在vue-computed中，将就一下
                saveOut('',vm.editOrNew);
            }
            if(state == ''){returnMyWen()}
        }
    }
//编辑问卷
    //编辑问卷启动函数
    function editWen(x) {
        if(checkChecked()){
            if(x == 'stillEdit' || vm.wenjuan[vm.selectWenIndex].state == '待发布'){
                $('#mainTable,#newBig').hide();
                $('#editBig').show();
                $('#header .checked').removeClass('checked')
                $('#editWenTag').addClass('checked')
                $('#content #editMain select option:first-child').prop('selected','true');
                let edit = JSON.parse(JSON.stringify(vm.wenjuan[vm.selectWenIndex]));
                vm.editwenjuan.splice(0,1,edit);
                vm.editOrNew = 'edit'
                if(x){floatClose();}
            }else{
                floatWindow('cantEdit','cantEdit')
            }
        }
    }
    //检查是否选中，单个删除和查看数据时也调用这函数
    function checkChecked() {
        vm.selectWenIndex = $('#mainTable tbody input[name="select"]:checked').parents('tr').index();
        if(vm.selectWenIndex == -1){
            floatWindow('alert','delNoCheck');
            return false
        }else{
            return true;
        }
    }

//删除问卷
    //删除问卷-确认
    function doDel(x) {
        if(x=='all'){
            floatWindow('delAll','delAll');
        }else if(x=='this' && checkChecked()) {//如果是删除单个，且有选中，弹出删除一个的提示框
            floatWindow('delOne','delThis');
        }
    }
    //删除问卷-删除一个
    function delOneWen() {
        vm.wenjuan.splice(vm.selectWenIndex,1);
        floatClose();
        checkWen();
    }
    //删除问卷-删除所有
    function delAllWen() {
        vm.wenjuan = [];
        checkWen();
    }

    //点击我的问卷标签
    function titleClick() {
        if($('#showBig').css('display') == 'block'){//如果是从查看页面退出，则直接回到主界面
            returnMyWen();
        }else{//相当于点击本页的 不保存退出 键
            $('#'+vm.editOrNew+'WenOut input:last').click();
        }
    }
    //回到我的问卷主界面
    function returnMyWen() {
        $('#float').hide();
        $('#mainTable').show();
        $('#content .big').hide();
        $('#header .checked').removeClass('checked')
        $('#myWen').addClass('checked');
        vm.editOrNew = '';
        checkWen();
    }

//查看问卷数据
    function showData() {
        if(checkChecked()){
            if(vm.wenjuan[vm.selectWenIndex].state != '待发布'){
                $('#mainTable').hide();
                $('#showBig').show();
                $('#header .checked').removeClass('checked')
                $('#showWenTag').addClass('checked')
                vm.editOrNew = '';
                drawCharts();
            }else{
                floatWindow('alert','cantShow')
            }
        }
    }
</script>
<script src="vm_vue.js" type="text/javascript"></script>
<script src="show_echarts.js" type="text/javascript"></script>
<script>
    checkWen();
    // 选择问卷
    $('#content').on('click','tbody tr',function () {
        var id = $(this).attr('id');
        if(id != 'last'){
            $('#content tbody').find('.selected').removeClass('selected')
            $(this).addClass('selected').find('input[type=radio]').prop('checked','true')
        }
    })

//编辑问卷
    //切换动画
    //新建问卷-标题编辑动画
    $('.big .wenName').click(function (e) {
        e.stopPropagation();
        let which = $(this).parent().attr('id');
        if(which != 'showMain'){
            $(this).parent().find('.qsButton').slideDown(200);
            if( ! vm.wenNameEditing){
                $(this).find('p').fadeOut(200,function () {
                    $(this).next().focus();
                });
            }
            vm.wenNameEditing = true;
            vm.qsTypeEditing = false;
        }
    })
    //新建问卷-选择题目类型动画
    $('.big .qsButton').click(function (e) {
        e.stopPropagation();
        $(this).parents('.main').find('.wenName p').fadeIn(200);
        if( ! vm.qsTypeEditing){
            $(this).slideUp(200);
        }
        vm.wenNameEditing = false;
        vm.qsTypeEditing = true;
    })
    //恢复标题编辑，选择题目类型动画
    $(document).click(function () {
        if(vm.editOrNew == 'new'){
            $('#newWenName').find('p').fadeIn(200);
            $('#new_newQsButton').slideDown(200);
        }else if(vm.editOrNew == 'edit'){
            $('#editWenName').find('p').fadeIn(200);
            $('#edit_newQsButton').slideDown(200);
        }
        vm.wenNameEditing = false;
        vm.qsTypeEditing = false;
    })
    //选项删除
    $('#content .qsList').on('click','.wenQs li>span',function () {
        //这里，因为元素是动态的，必须用on绑定到父级元素，用选择器找到子元素。
        //实测绑定到爷爷辈才生效，诡异
        let optionIndex = $(this).parent().index() - 1;
        let qsIndex = $(this).parents('.wenQs').index();
        //console.log('删除选项'+optionIndex,qsIndex)
        vm[vm.editOrNew+'wenjuan'][0].question[qsIndex].options.splice(optionIndex,1)
        if(vm[vm.editOrNew+'wenjuan'][0].question[qsIndex].options == 0){
            floatWindow('alert','noOptionQs');
        }
    })
    //是否为必选
    $('#content .qsList').on('click','.qsFunc input',function () {
        let qsIndex = $(this).parents('.wenQs').index();
        vm[vm.editOrNew+'wenjuan'][0].question[qsIndex].required = $(this).prop('checked');
    })
    //选项添加
    $('#content .qsList').on('click','.qsFunc .newOption',function () {
        vm.editWhichQs = $(this).parents('.wenQs').index();
        floatWindow('newOption','inputOne');
    })
    //添加选项-监听回车键，其他功能也用到这个监听
    $('#floatWindow').on('keydown','#alertContent input',function (e) {
        if(e.keyCode == 13){
            $(this).parents('#floatWindow').find('.windowB input:first-child').click();
        }
    })
    //添加选项--数据更新到vm
    function getNewOption() {
        vm[vm.editOrNew+'wenjuan'][0].question[vm.editWhichQs].options.push(
            $('#alertContent').find('input').val()
        );
        floatClose();
    }
    //调整题目顺序，新建和修改都用到这个func
    function moveArray(qs,turn,step) {
        //原理是两个位置的对象重新赋值为对方
        //Qs参数让函数能找到，这是哪道题；turn是移动方向，step是移动几步
        //涉及对象的拷贝，可以使用let name = Object.assign({},obj)，es6可以let {...name} = obj;
            //事实上上面两种拷贝，只能对首层深度拷贝，嵌套的json效果不好
            //深拷贝最靠谱的还是JSON.parse(JSON.stringify())，但也有缺陷，详见https://segmentfault.com/a/1190000010661297
        //涉及vue对数组变化的监控缺陷，详见文档的中部 https://cn.vuejs.org/v2/guide/list.html#ad
        let another;
        let type = qs.type;
        let wenIndex = qs.wenIndex
        let qsIndex = qs.qsIndex;
        let thisone = JSON.parse(JSON.stringify(vm[type][wenIndex].question[qsIndex]));
        if (turn == 'up'){
            another = JSON.parse(JSON.stringify(vm[type][wenIndex].question[qsIndex-step]));
            vm[type][wenIndex].question.splice(qsIndex-step,1,thisone)
        }else if(turn == 'down'){
            another = JSON.parse(JSON.stringify(vm[type][wenIndex].question[qsIndex+step]));
            vm[type][wenIndex].question.splice(qsIndex+step,1,thisone)
        }
        vm[type][wenIndex].question.splice(qsIndex,1,another)
    }
    //调整题目顺序-向上，绑定事件
    $('#content .wenBody').on('click','.qsFunc .upThis',function () {
        //即使是on绑定的事件，其获取的对象也是最终选择到的对象，而不是.WenBody
        moveArray({
            type:vm.editOrNew+'wenjuan',
            wenIndex : 0,//新建页面中只有一个问卷,怎么都是0，但如果type是'wenjuan'就不一样了
            qsIndex:$(this).parents('.wenQs').index()
        },'up',1)
    })
    //调整题目顺序-向上，绑定事件
    $('#content .wenBody').on('click','.qsFunc .downThis',function () {
        moveArray({
            type:vm.editOrNew+'wenjuan',
            wenIndex : 0,//如果是新建或者编辑页面，这个值永远是0，但如果type是'wenjuan'就不一样了
            qsIndex:$(this).parents('.wenQs').index()
        },'down',1)
    })
    //复用，绑定事件
    $('#content .qsList').on('click','.qsFunc .reuseThis',function () {
        let qsIndex = $(this).parents('.wenQs').index();
        let content = JSON.parse(JSON.stringify(vm[vm.editOrNew+'wenjuan'][0].question[qsIndex]));
        vm[vm.editOrNew+'wenjuan'][0].question.push(content)
    })
    //删除，绑定事件
    $('#content .qsList').on('click','.qsFunc .delThis',function (e) {
        let qsIndex = $(this).parents('.wenQs').index();
        vm[vm.editOrNew+'wenjuan'][0].question.splice(qsIndex,1);
        if(vm[vm.editOrNew+'wenjuan'][0].question.length == 0){
            e.stopPropagation()
            $(this).parents('.main').find('.qsButton').click();
        }
    })
    //添加题目-按钮事件-添加不同类型的题目
    function newQs(type) {
        switch(type){
            case 'radio':
                $("#floatWindow").addClass('bigger');
                floatWindow('newRadio','inputTwo')
                break;
            case 'check':
                $("#floatWindow").addClass('bigger');
                floatWindow('newCheck','inputTwo')
                break;
            case 'text':
                floatWindow('newText','inputOne')
                break;
        }
    }
    //添加题目-同步新的题目数据
    function getNewQs(x) {
        if(x=='radio' || x=='checkbox'){
            let text = $("#alertContent #inputTwo1").val() ;
            if(text){
                let option = $("#alertContent #inputTwo2").val();
                if (option.length != 0){
                    option = option.split(';');
                }else{
                    option = [];
                }
                vm[vm.editOrNew+'wenjuan'][0].question.push({
                    type:x,
                    text:text,
                    options:option,
                    required:true,
                    data:[]
                })
                floatClose();
            }else{alert('必须输入题干内容')}
        }else if(x == 'text'){
            let text = $("#alertContent input").val();
            if(text){
                vm[vm.editOrNew+'wenjuan'][0].question.push({
                    type:x,
                    text:text,
                    options:[],
                    required:true,
                    data:[]
                })
                floatClose();
            }else{alert('必须输入题干内容')}
        }
    }
    //编辑题干
    //绑定事件
    $('#content .wenBody').on('click','li img',function () {
        vm.editWhichQs = $(this).parents('.wenQs').index();
        floatWindow('editStems','editStems');
        setTimeout(function () {
            $('#float #alertContent input').val(vm[vm.editOrNew+'wenjuan'][0].question[vm.editWhichQs].text)
        },1)
    })
    function stemsEdit() {
        vm[vm.editOrNew+'wenjuan'][0].question[vm.editWhichQs].text = $('#float #alertContent input').val();
        floatClose();
    }
</script>
</html>